"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.webviewProviderEventHandler = void 0;
const isMobileWebview_1 = require("./helpers/isMobileWebview");
const windowProviderEnums_1 = require("@multiversx/sdk-web-wallet-cross-window-provider/out/enums/windowProviderEnums");
const webviewProviderEventHandler = (action, resolve, allowedOrigin) => {
    return (event) => {
        let eventData = event.data;
        try {
            eventData =
                (0, isMobileWebview_1.isMobileWebview)() && typeof eventData === 'string'
                    ? JSON.parse(eventData)
                    : eventData;
        }
        catch (err) {
            console.error('error parsing eventData', eventData);
        }
        const { type, payload } = eventData;
        if (!(0, isMobileWebview_1.isMobileWebview)() && event.origin !== allowedOrigin) {
            return;
        }
        const isCurrentAction = action === type || type === windowProviderEnums_1.WindowProviderResponseEnums.cancelResponse;
        if (!isCurrentAction) {
            return;
        }
        resolve({ type, payload });
    };
};
exports.webviewProviderEventHandler = webviewProviderEventHandler;
//# sourceMappingURL=webviewProviderEventHandler.js.map